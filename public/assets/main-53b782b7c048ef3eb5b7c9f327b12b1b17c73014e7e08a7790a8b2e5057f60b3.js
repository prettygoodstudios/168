$(document).ready(function(){function e(e){this.element=e,this.timeline=this.element.find(".timeline"),this.timelineItems=this.timeline.find("li"),this.timelineItemsNumber=this.timelineItems.length,this.timelineStart=n(this.timelineItems.eq(0).text()),this.timelineUnitDuration=n(this.timelineItems.eq(1).text())-n(this.timelineItems.eq(0).text()),this.eventsWrapper=this.element.find(".events"),this.eventsGroup=this.eventsWrapper.find(".events-group"),this.singleEvents=this.eventsGroup.find(".single-event"),this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.modal=this.element.find(".event-modal"),this.modalHeader=this.modal.find(".header"),this.modalHeaderBg=this.modal.find(".header-bg"),this.modalBody=this.modal.find(".body"),this.modalBodyBg=this.modal.find(".body-bg"),this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.initSchedule()}function t(){o.forEach(function(e){e.scheduleReset()}),s=!1}function n(e){e=e.replace(/ /g,"");var t=e.split(":");return 60*parseInt(t[0])+parseInt(t[1])}function i(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}e.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},e.prototype.scheduleReset=function(){var e=this.mq();"desktop"!=e||this.element.hasClass("js-full")?"mobile"==e&&this.element.hasClass("js-full")?(this.element.removeClass("js-full loading"),this.eventsGroup.children("ul").add(this.singleEvents).removeAttr("style"),this.eventsWrapper.children(".grid-line").remove(),this.element.hasClass("modal-is-open")&&this.checkEventModal()):"desktop"==e&&this.element.hasClass("modal-is-open")?(this.checkEventModal("desktop"),this.element.removeClass("loading")):this.element.removeClass("loading"):(this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.element.addClass("js-full"),this.placeEvents(),this.element.hasClass("modal-is-open")&&this.checkEventModal())},e.prototype.initEvents=function(){var e=this;this.singleEvents.each(function(){var e='<span class="event-date">'+$(this).data("begin")+" - "+$(this).data("done")+"</span>";$(this).children("a").prepend($(e))}),this.modal.on("click",".close",function(t){t.preventDefault(),e.animating||e.closeModal(e.eventsGroup.find(".selected-event"))}),this.element.on("click",".cover-layer",function(){!e.animating&&e.element.hasClass("modal-is-open")&&e.closeModal(e.eventsGroup.find(".selected-event"))})},e.prototype.placeEvents=function(){var e=this;this.singleEvents.each(function(){var t=n($(this).attr("data-start")),i=n($(this).attr("data-end"))-t,a=e.eventSlotHeight*(t-e.timelineStart)/e.timelineUnitDuration,o=e.eventSlotHeight*i/e.timelineUnitDuration;$(this).css({top:a-1+"px",height:o+1+"px"})}),this.element.removeClass("loading")},e.prototype.openModal=function(e){var t=this,n=t.mq();if(this.animating=!0,this.modalHeader.find(".event-name").text(e.find(".event-name").text()),this.modalHeader.find(".event-date").text(e.find(".event-date").text()),this.modal.attr("data-event",e.parent().attr("data-event")),this.modalBody.find(".event-info").load(e.parent().attr("data-content")+".html .event-info > *",function(){t.element.addClass("content-loaded")}),this.element.addClass("modal-is-open"),setTimeout(function(){e.parent("li").addClass("selected-event")},10),"mobile"==n)t.modal.one(transitionEnd,function(){t.modal.off(transitionEnd),t.animating=!1});else{var a=e.offset().top-$(window).scrollTop(),o=e.offset().left,s=e.innerHeight(),d=e.innerWidth(),l=$(window).width(),m=$(window).height(),r=.8*l>t.modalMaxWidth?t.modalMaxWidth:.8*l,h=.8*m>t.modalMaxHeight?t.modalMaxHeight:.8*m,p=parseInt((l-r)/2-o),c=parseInt((m-h)/2-a),f=h/s,g=r-d;t.modal.css({top:a+"px",left:o+"px",height:h+"px",width:r+"px"}),i(t.modal,"translateY("+c+"px) translateX("+p+"px)"),t.modalHeader.css({width:d+"px"}),t.modalBody.css({marginLeft:d+"px"}),t.modalBodyBg.css({height:s+"px",width:"1px"}),i(t.modalBodyBg,"scaleY("+f+") scaleX("+g+")"),t.modalHeaderBg.css({height:s+"px",width:d+"px"}),i(t.modalHeaderBg,"scaleY("+f+")"),t.modalHeaderBg.one(transitionEnd,function(){t.modalHeaderBg.off(transitionEnd),t.animating=!1,t.element.addClass("animation-completed")})}transitionsSupported||t.modal.add(t.modalHeaderBg).trigger(transitionEnd)},e.prototype.closeModal=function(e){var t=this,n=t.mq();if(this.animating=!0,"mobile"==n)this.element.removeClass("modal-is-open"),this.modal.one(transitionEnd,function(){t.modal.off(transitionEnd),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")});else{var a=e.offset().top-$(window).scrollTop(),o=e.offset().left,s=e.innerHeight(),d=e.innerWidth(),l=Number(t.modal.css("top").replace("px","")),m=Number(t.modal.css("left").replace("px","")),r=o-m,h=a-l;t.element.removeClass("animation-completed modal-is-open"),this.modal.css({width:d+"px",height:s+"px"}),i(t.modal,"translateX("+r+"px) translateY("+h+"px)"),i(t.modalBodyBg,"scaleX(0) scaleY(1)"),i(t.modalHeaderBg,"scaleY(1)"),this.modalHeaderBg.one(transitionEnd,function(){t.modalHeaderBg.off(transitionEnd),t.modal.addClass("no-transition"),setTimeout(function(){t.modal.add(t.modalHeader).add(t.modalBody).add(t.modalHeaderBg).add(t.modalBodyBg).attr("style","")},10),setTimeout(function(){t.modal.removeClass("no-transition")},20),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")})}transitionsSupported||t.modal.add(t.modalHeaderBg).trigger(transitionEnd)},e.prototype.mq=function(){return window.getComputedStyle(this.element.get(0),"::before").getPropertyValue("content").replace(/["']/g,"")},e.prototype.checkEventModal=function(){this.animating=!0;var e=this,t=this.mq();if("mobile"==t)e.modal.add(e.modalHeader).add(e.modalHeaderBg).add(e.modalBody).add(e.modalBodyBg).attr("style",""),e.modal.removeClass("no-transition"),e.animating=!1;else if("desktop"==t&&e.element.hasClass("modal-is-open")){e.modal.addClass("no-transition"),e.element.addClass("animation-completed");var n=e.eventsGroup.find(".selected-event"),a=(n.offset().top,$(window).scrollTop(),n.offset().left,n.innerHeight()),o=n.innerWidth(),s=$(window).width(),d=$(window).height(),l=.8*s>e.modalMaxWidth?e.modalMaxWidth:.8*s,m=.8*d>e.modalMaxHeight?e.modalMaxHeight:.8*d,r=m/a,h=l-o;setTimeout(function(){e.modal.css({width:l+"px",height:m+"px",top:d/2-m/2+"px",left:s/2-l/2+"px"}),i(e.modal,"translateY(0) translateX(0)"),e.modalBodyBg.css({height:m+"px",width:"1px"}),i(e.modalBodyBg,"scaleX("+h+")"),e.modalHeader.css({width:o+"px"}),e.modalBody.css({marginLeft:o+"px"}),e.modalHeaderBg.css({height:a+"px",width:o+"px"}),i(e.modalHeaderBg,"scaleY("+r+")")},10),setTimeout(function(){e.modal.removeClass("no-transition"),e.animating=!1},20)}};var a=$(".cd-schedule"),o=[],s=!1;a.length>0&&a.each(function(){o.push(new e($(this)))}),$(window).on("resize",function(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t))}),$(window).keyup(function(e){27==e.keyCode&&o.forEach(function(e){e.closeModal(e.eventsGroup.find(".selected-event"))})})});